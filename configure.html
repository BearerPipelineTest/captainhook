<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>CaptainHook Documentation</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/layout.css" rel="stylesheet">
    <link href="css/atom-one-dark.css" rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://github.com/captainhookphp/captainhook">CaptainHook</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="index.html">Home</a></li>
            <li><a href="install.html">Install</a></li>
            <li class="active"><a href="configure.html">Configure</a></li>
            <li><a href="hooks.html">Hooks</a></li>
            <li><a href="extend.html">Extend</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container theme-showcase" role="main">

      <h1>Configuration</h1>
      <p>
        If you look at a <em class="hl">captainhook.json</em> configuration, it consists of a config block for each
        hook and an optional <a href="#settings"><em>config</em></a> section to tweak some setting.
      </p>

      <pre><code class="javascript">{
  "commit-msg": {
    // a hook config block
  },
  "pre-commit": {
    // another hook config block
  },
  // ...
}</code></pre>

      <h3 id="hooks">Hook Config</h3>
      <p>
        Each hook configuration consists of two things an on/off switch and a list of actions to execute.
      </p>

      <pre><code class="javascript">'commit-msg': {
  "enabled": true,
  "actions": []
}</code></pre>

      <p>
        By setting <em>enabled</em> to <em>false</em>, <em>CaptainHook</em> will not execute the configured actions even if the hook is
        triggered by git.
      </p>

      <h3 id="actions">Actions</h3>
      <h4>CLI commands</h4>
      <p>
        Actions can be two things, firstly you can run any cli command, as long as it uses exit codes to notify the
        caller about its success. If you, for example, run <em>PHPUnit</em> and a test fails, it will exit with status
        code 1, so <em>CaptainHook</em> knows that it should stop the currently running git command with an error.
      </p>

      <pre><code class="javascript">{
  "pre-commit": {
    "enabled": true,
    "actions": [
      {
        "action": "phpunit.phar --configuration=phpunit.git.xml"
      }
    ]
  }
}</code></pre>

      <p>
        Using the example above in a <em>pre-commit</em> hook will prevent you from committing code that
        breaks any unit test.
      </p>
      <h4>PHP scripts</h4>
      <p>
        Secondly you can execute any PHP class implementing an interfaces defined by <em>CaptainHook</em>.
        The interface you have to implement is <em class="hl">\CaptainHook\App\Hook\Action</em>.
        CaptainHook comes with some built-in, basic validation classes. So let's have a look at how to configure
        those.
      </p>

      <pre><code class="javascript">{
  "commit-msg": {
    "enabled": true,
    "actions": [
      {
        "action": "\\CaptainHook\\App\\Hook\\Message\\Action\\Regex",
        "options": {
          "regex": "#.*#"
        }
      }
    ]
  }
}</code></pre>

      <p>
        With this configuration you can validate your commit messages against a regular expression. If your commit
        message doesn't match your regular expression your commit fails.
      </p>
      <p>Here's a list of all built-in actions</p>
      <h5>Commit-Message</h5>
      <ul>
        <li><a href="actions.html#regex">\CaptainHook\App\Hook\Message\Action\Regex</a><br>Simple regex matching</li>
        <li><a href="actions.html#rules">\CaptainHook\App\Hook\Message\Action\Rules</a><br>Execute a list of <em>Rules</em></li>
        <li><a href="actions.html#beams">\CaptainHook\App\Hook\Message\Action\Beams</a><br>Enforces the <a href="http://chris.beams.io/posts/git-commit/" target="_blank">Beams-Rules</a></li>
      </ul>
      <h5>Pre-Commit</h5>
      <ul>
        <li><a href="actions.html#check-lock-file">\CaptainHook\App\Hook\Composer\Action\CheckLockFile</a><br>Make sure your composer.lock file is up to date</li>
        <li><a href="actions.html#linting">\CaptainHook\App\Hook\PHP\Action\Linting</a><br>Check php files for syntax errors</li>
        <li><a href="actions.html#test-coverage">\CaptainHook\App\Hook\PHP\Action\TestCoverage</a><br>Monitors your test coverage</li>
      </ul>
      <p>
        You can easily build your own action classes. Have a look on how to <a href="extend.html">extend</a> CaptainHook.
      </p>
      <h3 id="conditions">Conditions</h3>
      <p>
        You can add conditions to an <em>action</em> configuration. Only if all configured conditions apply the action gets executed.
        This becomes useful for example if you want to run <em>composer install</em> automatically every time someone changes <em>composer.json</em>
        or <em>composer.lock</em>.
      </p>
      <p>
        To make sure you catch every change in your repository you have to add the action to both <em>post-merge</em> and <em>post-checkout</em>
        hooks. This way you run composer after every <em>merge</em> or <em>pull</em> or after checking out another branch that changes you local
        composer files.
      </p>

      <pre><code class="javascript">{
  "post-merge": {
    "enabled": true,
    "actions": [
      {
        "action": "composer install",
        "options": {},
        "conditions": [
          {
            "exec": "\\CaptainHook\\App\\Hook\\Condition\\FileChanged\\Any",
            "args": [
              ["composer.json", "composer.lock"]
            ]
          }
        ]
      }
    ]
  },
  "post-checkout": {
    "enabled": true,
    "actions": [
      {
        "action": "composer install",
        "options": {},
        "conditions": [
          {
            "exec": "\\CaptainHook\\App\\Hook\\Condition\\FileChanged\\Any",
            "args": [
              ["composer.json", "composer.lock"]
            ]
          }
        ]
      }
    ]
  }
}</code></pre>
      <p>Here's a list of all built-in conditions</p>
      <h5>post-merge / post-checkout</h5>
      <ul>
        <li>\CaptainHook\App\Hook\Condition\FileChange\Any</a><br>Check if <strong>any</strong> of the configured files is changed</li>
        <li>\CaptainHook\App\Hook\Condition\FileChange\All</a><br>Check if <strong>all</strong> of the configured files are changed</li>
      </ul>
      <p>
        You can build your own conditions. You can either use simple scripts or binaries which have to return an exit code.
        The exit code 0 means the condition applies, any exit code other then 0 means the condition does not apply.
      </p>
      <p>
        Or you can build custom PHP <em>Conditions</em>. For an exact guide have a look at the
        <a href="extend.html#conditions">"how to extend CaptainHook"</a> section.
      </p>

      <h3 id="includes">Include other configuration files</h3>
      <p>
        If you have a lot of projects you maybe want to define a set of default hooks for all of them. To maintain
        such a default configuration CaptainHook version 4.4.0 introduced the possibility to include other <em>CaptainHook</em> configurations like this.
      </p>
      <pre><code class="javascript">{
  "config": {
    "includes": [
      "some-other-captainhook-config.json"
    ]
  },
  "pre-commit": {
    "enabled": true,
    "actions": [
      {
        "action"0: "\\CaptainHook\\App\\Hook\\Message\\Action\\Regex",
        "options": {
          "regex": "#.*#"
        }
      }
    ]
  }
}</code></pre>
      <p>
        The idea is to create a separate <em>composer</em> package e.g. <em class="hl">my-git-hooks</em> that is structured like this.
      </p>
      <pre><code class="javascript">my-git-hooks/
├── composer.json
├── msg-validation.json
└── crazy-workflow.json</code></pre>
      <p>
        Inside your composer.json you require all libs and plugins you need to execute the configured actions plus <em>captainhook/captainhook</em>
        or <em>captainhook/plugin-composer</em>. The only thing you have to do in your projects is to require your <em class="hl">my-git-hooks</em>
        package and add something like this to your local project <em>captainhook.json</em> file.
      </p>
      <pre><code class="javascript">{
  "config": {
    "includes": [
      "vendor/my-company/my-git-hooks/msg-validation.json",
      "vendor/my-company/my-git-hooks/crazy-workflow.json"
    ]
  }
}</code></pre>
      <p>
        To update the base configuration you create a new version for your <em class="hl">my-git-hooks</em> package and run composer update in your projects.
      </p>

      <h4>Include Level</h4>
      <p>
        By default you can't include configurations in included configurations. But if you really want to shoot yourself in the foot, who am I to judge you.
        You can increase the maximum levels of inclusion in your project configuration. Be aware, that setting this in any included configuration will have no effect.
      </p>
      <pre><code class="javascript">{
  "config": {
    "includes-level": 2,
    "includes": [
      "vendor/my-company/my-git-hooks/msg-validation.json",
      "vendor/my-company/my-git-hooks/crazy-workflow.json"
    ]
  }
}</code></pre>

      <a name="settings"></a>
      <h2>Settings</h2>
      <p>
       For example if your .git directory is not located on the same level as your captainhook.json.
      </p>
      <pre><code class="javascript">{
  "config": {
    "git-directory": "../../.git",
    "verbosity": "verbose",
    "ansi-colors": false,
    "includes-level": 2,
    "includes": [],
    "run-mode": "docker",
    "run-exec": "docker exec CONTAINER_NAME",
    "run-path": "./vendor/bin
  }
}</code></pre>

      <table class="table">
        <tr>
          <th>Setting</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
        <tr>
          <td>git-directory</td>
          <td>Custom path to your repositories .git directory (relative from the configuration file)</td>
          <td>.git</td>
        </tr>
        <tr>
          <td>verbosity</td>
          <td>Define the output verbosity [quiet|normal|verbose|debug]</td>
          <td>verbose</td>
        </tr>
        <tr>
          <td>ansi-colors</td>
          <td>Enable or disable ANSI color output</td>
          <td>true</td>
        </tr>
        <tr>
          <td>includes</td>
          <td>A list of CaptainHook configuration files to include</td>
          <td>-</td>
        </tr>
        <tr>
          <td>includes-level</td>
          <td>Nesting level of allowed config file inclusion</td>
          <td>0</td>
        </tr>
        <tr>
          <td>run-mode</td>
          <td>CaptainHook execution mode (local|docker)</td>
          <td>local</td>
        </tr>
        <tr>
          <td>run-exec</td>
          <td>Docker command to spin up the container and execute a script</td>
          <td>-</td>
        </tr>
        <tr>
          <td>run-path</td>
          <td>Path to the command inside your docker container</td>
          <td>-</td>
        </tr>
      </table>

    </div>

    <footer class="footer">
      <div class="container">
        <p>
          Found a typo or a bug?
          Please open an <a href="https://github.com/captainhookphp/captainhook/issues">issue</a>
          or pull request for the <em>gh-pages</em>
          branch of <a href="https://github.com/captainhookphp/captainhook/tree/gh-pages">CaptainHook</a>
        </p>
        <p>
          &copy; <a href="https://github.com/sebastianfeldmann">Sebastian Feldmann</a>
        </p>
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
